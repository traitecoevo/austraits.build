<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • austraits.build</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">austraits.build</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
    home
  </a>
</li>
<li>
  <a href="../articles/austraits.build.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Details
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/austraits_structure.html">Structure of `AusTraits` data compilation</a>
    </li>
    <li>
      <a href="../articles/Trait_definitions.html">Definitions for traits in `AusTraits`</a>
    </li>
    <li>
      <a href="../articles/austraits_raw_data.html">Structure of raw data in `AusTraits`</a>
    </li>
    <li>
      <a href="../articles/adding_data.html">Adding data to `AusTraits`</a>
    </li>
    <li>
      <a href="../articles/Docker.html">Docker for reproducible compute environment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-list"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/traitecoevo/austraits.build">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="austraits_raw_data_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1></h1>
            
      
      
      <div class="hidden name"><code>austraits_raw_data.Rmd</code></div>

    </div>

    
    
<div id="file-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#file-structure" class="anchor"></a>File structure</h2>
<p>The main directory for the <a href="https://github.com/traitecoevo/austraits.build/"><code>austraits.build</code> repository</a> repository contains the following files and folders, with purpose as indicated.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/create_tree_branch.html">create_tree_branch</a></span>(<span class="dt">title =</span> <span class="st">"austraits"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>()</a></code></pre></div>
<pre><code>austraits
├── austraits.build.Rproj  # Rstudio project 
├── config                 # configuration and definition files
├── data                   # raw data files
├── DESCRIPTION            # R package description
├── Dockerfile             # Creates container for docker
├── docs                   # documentation
├── export                 # for output
├── R                      # R functions used during build
├── README.md              # landing page
├── remake.yml             # instructions for build
├── scripts                # 
└── tests                  # defines tests applied to datasets</code></pre>
</div>
<div id="configuration" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration" class="anchor"></a>Configuration</h2>
<p>The folder <code>config</code> contains three files which govern the building of the dataset.</p>
<pre><code>config
├── definitions.yml
├── species_list.csv
└── unit_conversions.csv</code></pre>
<p>The file <code>definitions.yml</code> defines the structure of the database and all terms. The tables and definitions provided in the section above on <a href="#austraits_structure%5D">Structure of AusTraits</a> are defined in this file, as are trait definitions. A <code>.yml</code> file is a structured data file where information is presented in a hierarchical format (see <a href="#yaml">appendix for details</a>). You will need to edit this file if you are changing or adding trait definitions.</p>
<p>The file <code>species_list.csv</code> is our master list of known species. Each species is listed once, with known IDs (see <a href="#taxonomic">section above</a> for details).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">read_csv</span>(<span class="st">"config/species_list.csv"</span>) </a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt;   species_name = col_character(),</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;   family = col_character(),</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;   authority = col_character(),</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;   TPL_ID = col_character(),</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt;   status = col_character(),</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt;   APC_name = col_character(),</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt;   APC_ID = col_character(),</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt;   APNI_ID = col_character()</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; )</span></a></code></pre></div>
</div>
<div id="a-tibble-21009-x-8" class="section level1">
<h1 class="hasAnchor">
<a href="#a-tibble-21009-x-8" class="anchor"></a>A tibble: 21,009 x 8</h1>
<p>species_name family authority TPL_ID status APC_name APC_ID APNI_ID <chr><chr><chr><chr><chr><chr><chr><chr><br>
1 Abelmoschus fi… Malvac… (L.) Wight … kew-2… Accep… Abelmoschu… 28979… 55929<br>
2 Abelmoschus ma… Malvac… (L.) Medik. kew-2… Accep… Abelmoschu… 29010… 55937<br>
3 Abelmoschus mo… Malvac… Medik. kew-2… Accep… Abelmoschu… 29005… 55953<br>
4 Abroma augusta Malvac… (L.) L.f. kew-2… Accep… Abroma mol… 29048… 199881 5 Abrophyllum or… Rousse… (F.Muell.) … kew-2… Accep… Abrophyllu… 28936… 56085<br>
6 Abrotanella fo… Compos… (Hook.f.) B… gcc-9… Accep… unknown unkno… unknown 7 Abrotanella ni… Compos… (F.Muell.) … gcc-3… Accep… Abrotanell… 29005… 56120<br>
8 Abrus precator… Legumi… L. ild-2… Accep… Abrus prec… 29193… 56149<br>
9 Abrus precator… Legumi… Verdc. ild-2… Accep… Abrus prec… 29161… 56158<br>
10 Abutilon aff. … Malvac… Benth. kew-2… Accep… Abutilon s… 29038… 56823<br>
# … with 20,999 more rows</chr></chr></chr></chr></chr></chr></chr></chr></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">austraits<span class="op">$</span>taxonomy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(species_name,family,authority,TPL_ID,status,APC_name,APC_ID,APNI_ID) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">my_kable_styling</span>()</a></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive">
<thead><tr>
<th style="text-align:left;">
species_name
</th>
<th style="text-align:left;">
family
</th>
<th style="text-align:left;">
authority
</th>
<th style="text-align:left;">
TPL_ID
</th>
<th style="text-align:left;">
status
</th>
<th style="text-align:left;">
APC_name
</th>
<th style="text-align:left;">
APC_ID
</th>
<th style="text-align:left;">
APNI_ID
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Abelmoschus
</td>
<td style="text-align:left;">
Malvaceae
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Abelmoschus ficulneus
</td>
<td style="text-align:left;">
Malvaceae
</td>
<td style="text-align:left;">
(L.) Wight &amp; Arn.
</td>
<td style="text-align:left;">
kew-2609577
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abelmoschus ficulneus
</td>
<td style="text-align:left;">
2897916
</td>
<td style="text-align:left;">
55929
</td>
</tr>
<tr>
<td style="text-align:left;">
Abelmoschus manihot
</td>
<td style="text-align:left;">
Malvaceae
</td>
<td style="text-align:left;">
(L.) Medik.
</td>
<td style="text-align:left;">
kew-2609589
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abelmoschus manihot
</td>
<td style="text-align:left;">
2901085
</td>
<td style="text-align:left;">
55937
</td>
</tr>
<tr>
<td style="text-align:left;">
Abelmoschus moschatus
</td>
<td style="text-align:left;">
Malvaceae
</td>
<td style="text-align:left;">
Medik.
</td>
<td style="text-align:left;">
kew-2609599
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abelmoschus moschatus
</td>
<td style="text-align:left;">
2900572
</td>
<td style="text-align:left;">
55953
</td>
</tr>
<tr>
<td style="text-align:left;">
Abroma augusta
</td>
<td style="text-align:left;">
Malvaceae
</td>
<td style="text-align:left;">
(L.) L.f.
</td>
<td style="text-align:left;">
kew-2610167
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abroma molle
</td>
<td style="text-align:left;">
2904866
</td>
<td style="text-align:left;">
199881
</td>
</tr>
<tr>
<td style="text-align:left;">
Abrophyllum ornans
</td>
<td style="text-align:left;">
Rousseaceae
</td>
<td style="text-align:left;">
(F.Muell.) Hook.f.
</td>
<td style="text-align:left;">
kew-2610292
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abrophyllum ornans
</td>
<td style="text-align:left;">
2893678
</td>
<td style="text-align:left;">
56085
</td>
</tr>
<tr>
<td style="text-align:left;">
Abrotanella forsterioides
</td>
<td style="text-align:left;">
Compositae
</td>
<td style="text-align:left;">
(Hook.f.) Benth.
</td>
<td style="text-align:left;">
gcc-99065
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
unknown
</td>
<td style="text-align:left;">
unknown
</td>
</tr>
<tr>
<td style="text-align:left;">
Abrotanella nivigena
</td>
<td style="text-align:left;">
Compositae
</td>
<td style="text-align:left;">
(F.Muell.) F.Muell. ex Benth.
</td>
<td style="text-align:left;">
gcc-31570
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abrotanella nivigena
</td>
<td style="text-align:left;">
2900512
</td>
<td style="text-align:left;">
56120
</td>
</tr>
<tr>
<td style="text-align:left;">
Abrotanella scapigera
</td>
<td style="text-align:left;">
Compositae
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Abrus precatorius
</td>
<td style="text-align:left;">
Leguminosae
</td>
<td style="text-align:left;">
L.
</td>
<td style="text-align:left;">
ild-2477
</td>
<td style="text-align:left;">
Accepted
</td>
<td style="text-align:left;">
Abrus precatorius
</td>
<td style="text-align:left;">
2919311
</td>
<td style="text-align:left;">
56149
</td>
</tr>
</tbody>
</table>
<p>The file <code>unit_conversions.csv</code> defines the unit conversions that are used when converting traits to common units, e.g.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">read_csv</span>(<span class="st">"config/unit_conversions.csv"</span>, <span class="dt">col_types =</span> <span class="st">"ccc"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">my_kable_styling</span>()</a></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive">
<thead><tr>
<th style="text-align:left;">
unit_from
</th>
<th style="text-align:left;">
unit_to
</th>
<th style="text-align:left;">
function
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
% dry weight
</td>
<td style="text-align:left;">
mg/g
</td>
<td style="text-align:left;">
x*10
</td>
</tr>
<tr>
<td style="text-align:left;">
%
</td>
<td style="text-align:left;">
mg/g
</td>
<td style="text-align:left;">
x*10
</td>
</tr>
<tr>
<td style="text-align:left;">
%
</td>
<td style="text-align:left;">
g/g
</td>
<td style="text-align:left;">
x*0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
cm2/g
</td>
<td style="text-align:left;">
mm2/mg
</td>
<td style="text-align:left;">
x*0.1
</td>
</tr>
<tr>
<td style="text-align:left;">
cm2
</td>
<td style="text-align:left;">
mm2
</td>
<td style="text-align:left;">
x*100
</td>
</tr>
<tr>
<td style="text-align:left;">
g
</td>
<td style="text-align:left;">
mg
</td>
<td style="text-align:left;">
x*1000
</td>
</tr>
<tr>
<td style="text-align:left;">
mm
</td>
<td style="text-align:left;">
m
</td>
<td style="text-align:left;">
x*0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
%
</td>
<td style="text-align:left;">
mg/g
</td>
<td style="text-align:left;">
x*10
</td>
</tr>
<tr>
<td style="text-align:left;">
g/m2
</td>
<td style="text-align:left;">
mm2/mg
</td>
<td style="text-align:left;">
1/x*1000/1
</td>
</tr>
<tr>
<td style="text-align:left;">
mmol/g
</td>
<td style="text-align:left;">
mg/g
</td>
<td style="text-align:left;">
x*14.0067
</td>
</tr>
</tbody>
</table>
<div id="r" class="section level2">
<h2 class="hasAnchor">
<a href="#r" class="anchor"></a>R</h2>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>The folder <code>data</code> contains the raw data from individual studies included in AusTraits. Data from each study is organised into a separate folder, with two files:</p>
<ul>
<li>
<code>data.csv</code>: a table containing the actual trait data.</li>
<li>
<code>metadata.yml</code>: contains information about the study, maps trait names and units onto standard types, and lists any substitutions applied to the data in processing.</li>
</ul>
<p>The folder <code>data</code> thus contains a long list of folders, one for each study and each containing two files:</p>
<pre><code>data
├── Angevin_2010
│   ├── data.csv
│   └── metadata.yml
├── Barlow_1981
│   ├── data.csv
│   └── metadata.yml
├── Bean_1997
│   ├── data.csv
│   └── metadata.yml
├── ....
</code></pre>
<p>where <code>Angevin_2010</code>, <code>Barlow_1981</code>, &amp; <code>Bean_1997</code> are each a unique <code>dataset_id</code> in the final dataset.</p>
<div id="create_data" class="section level3">
<h3 class="hasAnchor">
<a href="#create_data" class="anchor"></a>Data.csv</h3>
<p>The file <code>data.csv</code> file contains raw measurements and can be in either long or wide format.</p>
<p>Required columns include the species name, the trait name (column in long format, header in wide format), units (column in long format, part of header in wide format), site (if applicable), and trait values.</p>
<p>If multiple trait measurements were made on the same individual or are the mean of a species’ measurements from the same site, they should be kept linked. If the data is in wide format, each row should represent measurements made on a single individual or a single species-by-site mean, with different trait values as consecutive columns. If the data is in long format, an observation ID (or other identifier) must be assigned to identify which measurements are linked to a unique individual or site.</p>
<p>We aim to keep the data file in rawest form possible (i.e. as few changes as possible) but it must be a single csv file. Additional custom R code may be required to make the file exactly compatible with the AusTraits format, but these changes should be executed as AusTraits is compiled and should be in the <code>metadata.yml</code> file under <code>config/custom_R_code</code> (see below). Any files used to create the submitted <code>data.csv</code> file (e.g. Excel …) should be archived in a sub-folder within the study folder named <code>raw</code>.</p>
</div>
<div id="metadata-yml" class="section level3">
<h3 class="hasAnchor">
<a href="#metadata-yml" class="anchor"></a>Metadata.yml</h3>
<p>The metadata is compiled in a <code>.yml</code> file, a structured data file where information is presented in a hierarchical format (see <a href="#yaml">Appendix for details</a>). There are 9 values at the top hierarchical level: source, people, dataset, sites, config, traits, substitutions, taxonomic_updates, questions. These are each described below.</p>
<p>As a start, you may want to checkout some examples from <a href="https://github.com/traitecoevo/austraits/tree/master/data">existing studies in Austraits</a>, e.g. <a href="https://github.com/traitecoevo/austraits/blob/master/data/Angevin_2010/metadata.yml">Angevin_2010</a> or <a href="https://github.com/traitecoevo/austraits/blob/master/data/Wright_2004/metadata.yml">Wright_2004</a>.</p>
<div id="source" class="section level4">
<h4 class="hasAnchor">
<a href="#source" class="anchor"></a>Source</h4>
<p>This section provides citation details for the original source(s) for the data, whether it is a published journal article, book, website, or thesis. In general we aim to reference the primary source. References are written in structured yml format, under the category <code>source</code> and then sub-groupings <code>primary</code> and <code>secondary</code>. General guidelines for describing a source</p>
<ul>
<li>maximum of one primary source allowed.</li>
<li>elements are names as in <a href="https://en.wikipedia.org/wiki/BibTeX">bibtex format</a>.</li>
<li>keys should be named in the format <code>Surname_year</code> and should be identical to the name given to the dataset folder. A second instance of the identical Surname_year should have the key Surname_year_2.</li>
<li>one or more secondary source may be if traits from a single dataset were presented in two different manuscripts. Multiple sources are also appropriate if an author has compiled data from a number of sources, that are not individually in AusTraits, for a published or unpublished compilation.</li>
<li>if your data is from an unpublished study, only include the elements that are applicable.</li>
<li>If someone has transcribed a published source, the primary source will be the published work and the person who has completed the transcription will be acknowledged as the `contributor of the dataset.</li>
</ul>
<p>Following are some examples for different types of source.</p>
<p>A journal article:</p>
<pre><code>source:
  primary:
    key: Falster_2005
    bibtype: Article
    author: Daniel S. Falster, Mark Westoby
    year: 2005 title: Alternative height strategies among 45 dicot rain forest species from tropical Queensland, Australia
    journal: Journal of Ecology volume: 93 pages: 521--535
    publisher: Wiley-Blackwell
    doi: 10.1111/j.0022-0477.2005.00992.x
  secondary: .na</code></pre>
<p>A book:</p>
<pre><code>source:
  primary:
    key: Cooper_2004
    bibtype: Book
    author: Wendy Cooper, William T. Cooper
    year: 2004
    title: Fruits of the Australian tropical rainforest
    publisher: Nokomis Editions
    isbn: '9780958174213'
  secondary: .na</code></pre>
<p>An online resource:</p>
<pre><code>source:
  primary: key: WAH_1998
    bibtype: Misc
    author: Western Australian Herbarium
    year: 1998
    title: FloraBase--the Western Australian Flora
    publisher: Department of Parks and Wildlife
    url: https://florabase.dpaw.wa.gov.au/
  secondary: .na</code></pre>
<p>An unpublished resource:</p>
<pre><code>source:
  primary:
    key: Duncan_1998
    bibtype: Unpublished
    author: David H. Duncan
    year: 1998
    title: Leaf anatomy of Australian plant species
    note: Collected while at Macquarie University
  secondary: .na</code></pre>
<p>Note that in these first examples <code>secondary</code> is set as <code>.na</code>. If a secondary source is included it may look like:</p>
<pre><code>  primary:
    key: Chave_2009
    bibtype: Article
    author: Jerome Chave, David Coomes, Steven Jansen, Simon L. Lewis, Nathan G. Swenson, Amy E. Zanne
    year: 2009 title: Towards a worldwide wood economics spectrum
    journal: Ecology Letters
    volume: 12
    pages: 351--366
    publisher: Wiley-Blackwell
    doi: 10.1111/j.1461-0248.2009.01285.x
  secondary:
    key: Zanne_2009
    bibtype: Misc
    author: Amy E. Zanne, G. Lopez-Gonzalez, David A. Coomes, Jugo Ilic, Steven Jansen, Simon L. Lewis, Regis B. Miller, Nathan G. Swenson, Michael C. Wiemann, Jerome   Chave
    year: 2009
    title: 'Data from: Towards a worldwide wood economics spectrum'
    volume: .na
    pages: .na
    publisher: Dryad Digital Repository
    doi: 10.5061/dryad.234</code></pre>
</div>
<div id="people" class="section level4">
<h4 class="hasAnchor">
<a href="#people" class="anchor"></a>People</h4>
<p>This section provides a list of the key contributors to the study, their respective institutions and roles in the study. Roles are defined as follows:</p>
<table class="table table table-striped table-hover table-condensed table-responsive">
<thead><tr>
<th style="text-align:left;">
key
</th>
<th style="text-align:left;">
value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
collector
</td>
<td style="text-align:left;">
The person (people) leading data collection (up to 2 permitted)
</td>
</tr>
<tr>
<td style="text-align:left;">
contributor
</td>
<td style="text-align:left;">
Person responsible for entering data into AusTraits
</td>
</tr>
<tr>
<td style="text-align:left;">
lab_leader
</td>
<td style="text-align:left;">
Leader of lab group at time of collection
</td>
</tr>
<tr>
<td style="text-align:left;">
assistant
</td>
<td style="text-align:left;">
Anyone else who assisted in collection of the data
</td>
</tr>
<tr>
<td style="text-align:left;">
contact
</td>
<td style="text-align:left;">
The person to contact with questions about the data set
</td>
</tr>
</tbody>
</table>
<p>An example is as follows:</p>
<pre><code>people:
- name: Daniel Falster
  institution: Macquarie University
  role: collector, contact, contributor
- name: Mark Westoby
  institution: Macquarie University
  role: lab_leader
</code></pre>
<p>Note that only the AusTraits custodians have the contributors e-mail addresses on file. This information will not be directly available to AusTraits users or new contributors via Github.</p>
</div>
<div id="dataset" class="section level4">
<h4 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h4>
<p>This section details about the study where the data were collected</p>
<p>The following elements are included under the element <code>dataset</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">values &lt;-<span class="st"> </span>definitions<span class="op">$</span>metadata<span class="op">$</span>elements<span class="op">$</span>dataset<span class="op">$</span>values</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="cf">for</span>(value <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(values)) {</a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"- **%s**: %s"</span>, value, values[[value]]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>()</a>
<a class="sourceLine" id="cb14-4" title="4">}</a></code></pre></div>
<ul>
<li>
<strong>year_collected_start</strong>: The year data collection commenced</li>
<li>
<strong>year_collected_end</strong>: The year data collection was completed</li>
<li>
<strong>description</strong>: A 1-2 sentence description of the purpose of the study.</li>
<li>
<strong>collection_type</strong>: A field to indicate where the plants on which traits were measured were collected - in the <code>field</code>, <code>lab</code>, <code>glasshouse</code>, <code>herbarium specimens</code>, or <code>literature</code>. The latter should only be used when the data were sourced from the literature and the collection type is unknown.</li>
<li>
<strong>sample_age_class</strong>: A field to indicate if the study was completed on <code>adult</code> or <code>juvenile</code> plants</li>
<li>
<strong>sampling_strategy</strong>: A written description of how study sites were selected and how study individuals were selected. When available, this information is lifted verbatim from a published manuscript. For herbarium studies, this field ideally indicates which herbaria were ‘sampled’ to measure a specific trait</li>
<li>
<strong>original_file</strong>: The name of the file initially submitted to AusTraits</li>
<li>
<strong>notes</strong>: Generic notes about the study and processing of data</li>
</ul>
<p>An example is as follows:</p>
<pre><code>  year_collected_start: 2004
  year_collected_end: 2004
  description: Trait values for species with faster versus slower height growth following disturbance for Myall Lakes species.
  collection_type: field
  sample_age_class: adult
  sampling_strategy: Fire is a recurrent disturbance in the park (interval – 0–30 years; Fox and Fox 1986). A mosaic of fire histories has facilitated previous use of space-for-time substitutions in studies of small mammal succession (Fox and McKay 1981). Here we employ the same methodology to reconstruct species height-growth trajectories (Enright and Goldblum 1999). Sites were identified at a range of times since fire with the use of NSW national parks GIS fire history records and personal observations of Karen Ross (Ross et al. 2002). Patches of vegetation 1, 2, 4, 8, 10, 12, 15, 27 and 28 years since fire were identified. Where possible several patches within a given age class were surveyed to determine species presence or absence. Nineteen species recorded in a majority of patches were selected for further study. This included eight resprouting species and 11 obligate seeders (full list in Appendix 1).
  original_file: Falster &amp; Westoby 2005 Oikos appendix.doc
  notes: none</code></pre>
</div>
<div id="config" class="section level4">
<h4 class="hasAnchor">
<a href="#config" class="anchor"></a>Config</h4>
<p>This section information on the format of the submitted data file</p>
<p>Values are as follows:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">values &lt;-<span class="st"> </span>definitions<span class="op">$</span>metadata<span class="op">$</span>elements<span class="op">$</span>config<span class="op">$</span>elements</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="cf">for</span>(value <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(values)) {</a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"- **%s**: %s"</span>, value, values[[value]]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>()</a>
<a class="sourceLine" id="cb16-4" title="4">}</a></code></pre></div>
<ul>
<li>
<strong>data_is_long_format</strong>: Indicates if the data spreadsheet has a vertical (long) or horizontal (wide) configuration with <code>yes</code> or <code>no</code> terminology</li>
<li>
<strong>variable_match</strong>: Identifies which information is in each column in the file <code>data.csv</code>, excluding the actual trait data. One element within <code>variable_match</code> must be <code>species_name</code>. Datasets with <code>data_is_long_format</code> set to <code>yes</code> must also identify which column includes data on <code>value</code> and <code>trait_name</code>. Other allowed values include <code>site_name</code> and <code>observation_id</code>, if these columns are present in the <code>data.csv</code> file.</li>
<li>
<strong>custom_R_code</strong>: A field where additional R code can be included. This allows for custom manipulation of the data in the submitted spreadsheet into a different format for easy integration with AusTraits. <code>.na</code> indicates no custom R code was used.</li>
</ul>
<p>An example is</p>
<pre><code>config:
  data_is_long_format: yes
  variable_match:
    species_name: Taxon
    value: trait value
    trait_name: trait
  custom_R_code: mutate(data, `trait value` = ifelse(trait == 'flowering time', convert_month_range_vec_to_binary(`trait value`), `trait value`))</code></pre>
<p>A common use of the <code>custom_R_code</code> is to automate the conversion of a verbal description of flowering or fruiting periods into the supported trait values, as occurs in this example. It might also be used if values for a single trait are expressed across multiple columns and need to be merged. See the <code>Catford_2014</code> as an example of this. Additional examples on adding <code>custom_R_code</code> are provided <a href="#custom_R_code">in the appendix</a>.</p>
</div>
<div id="traits" class="section level4">
<h4 class="hasAnchor">
<a href="#traits" class="anchor"></a>Traits</h4>
<p>This section provides A translation table mapping traits and units in the original study onto corresponding variables in AusTraits. Also specified here are methods used to collect the data.</p>
<p>For each trait submitted to Austraits, there is the following information:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">values &lt;-<span class="st"> </span>definitions<span class="op">$</span>metadata<span class="op">$</span>elements<span class="op">$</span>traits<span class="op">$</span>elements</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="cf">for</span>(value <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(values)) {</a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"- **%s**: %s"</span>, value, values[[value]]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>()</a>
<a class="sourceLine" id="cb18-4" title="4">}</a></code></pre></div>
<ul>
<li>
<strong>var_in</strong>: Names of trait in the original data submitted</li>
<li>
<strong>unit_in</strong>: Units of trait in the original data submitted</li>
<li>
<strong>trait_name</strong>: Name of trait sampled. Allowable values specified in the table <code>traits</code>.</li>
<li>
<strong>value_type</strong>: A categorical variable describing the type of trait value recorded</li>
<li>
<strong>replicates</strong>: Number of replicate measurements that comprise the data points for the trait for each measurement. A numeric value (or range) is ideal and appropriate if the value type is a <code>mean</code>, <code>median</code>, <code>min</code> or <code>max</code>. For these value types, if replication is unknown the entry should be <code>unknown</code>. If the value type is <code>raw_value</code> the replicate value should be <code>1</code>. If the value type is <code>expert_mean</code>, <code>expert_min</code>, or <code>expert_max</code> the replicate value should be <code>.na</code>.</li>
<li>
<strong>methods</strong>: A textual description of the methods used to collect the trait data. Whenever available, methods are taken near-verbatim from referenced souce. Methods can include descriptions such as ‘measured on herbarium specimens’,‘data from the literature’, or a detailed description of the field or lab methods used to collect the data.</li>
</ul>
<p>Values under <code>trait_name</code> must be allowable values, as described under <a href="#trait_defs">the section trait definitions</a>. Similarly, values under <code>value_type</code> must be allowable values, as described under <a href="#value_types">the section Value types</a>.</p>
<p>An example is as follows:</p>
<pre><code>traits:
- var_in: LMA (mg mm-2)
  unit_in: mg/mm2
  trait_name: specific_leaf_area
  value_type: site_mean
  replicates: 3
  methods: LMA was calculated as the leaf dry mass (oven-dried for 48 hours at 65 °C) divided by leaf size. It was measured on the first five fully expanded leaves at the tip of each individual.
- var_in: leaf size (mm2)
  unit_in: mm2
  trait_name: leaf_area
  value_type: site_mean
  replicates: 3
  methods: Leaf size was calculated as the one-sided leaf area (flat bed scanner). It was measured on the first five fully expanded leaves at the tip of each individual.</code></pre>
</div>
<div id="substitutions" class="section level4">
<h4 class="hasAnchor">
<a href="#substitutions" class="anchor"></a>Substitutions</h4>
<p>This section provides a list of any “find and replace” substitutions needed to get the data to get it into the right format</p>
<p>Substitutions are required whenever the exact word(s) used to describe a categorical trait value in AusTraits are different from the vocabulary used by the author in the <code>data.csv</code> file. It is preferable that authors make changes using <code>substitutions</code> rather than changing the <code>data.csv</code> file. See the section <a href="#trait_defs">trait definitions</a> for a list of supported values for each trait.</p>
<p>Each substitution is documented using the following elements:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">values &lt;-<span class="st"> </span>definitions<span class="op">$</span>metadata<span class="op">$</span>elements<span class="op">$</span>substitutions<span class="op">$</span>values</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="cf">for</span>(value <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(values)) {</a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"- **%s**: %s"</span>, value, values[[value]]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>()</a>
<a class="sourceLine" id="cb20-4" title="4">}</a></code></pre></div>
<ul>
<li>
<strong>trait_name</strong>: Name of variable to search</li>
<li>
<strong>find</strong>: Value to find</li>
<li>
<strong>replace</strong>: Replacement value</li>
</ul>
<p>An example is as follows:</p>
<pre><code>substitutions:
- trait_name: life_history
  find: p
  replace: perennial
- trait_name: plant_growth_form
  find: s
  replace: shrub
- ...</code></pre>
</div>
<div id="taxonomic-updates" class="section level4">
<h4 class="hasAnchor">
<a href="#taxonomic-updates" class="anchor"></a>Taxonomic updates</h4>
<p>This section provides a list of taxonomic name changes needed to align with current taxonomy Taxonomic updates are required to align species names with an accepted species list (for details, see details on <a href="#taxonomy">Taxonony</a>.</p>
<p>Each substitution is documented using the following elements:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">values &lt;-<span class="st"> </span>definitions<span class="op">$</span>metadata<span class="op">$</span>elements<span class="op">$</span>taxonomic_updates<span class="op">$</span>values</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="cf">for</span>(value <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(values)) {</a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"- **%s**: %s"</span>, value, values[[value]]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>()</a>
<a class="sourceLine" id="cb22-4" title="4">}</a></code></pre></div>
<ul>
<li>
<strong>find</strong>: Taxonomic name given to species in the original data supplied by the authors</li>
<li>
<strong>replace</strong>: Name of species after aligning taxonomy with standard sources.</li>
<li>
<strong>reason</strong>: Records why the change was implemented, e.g. <code>typos</code>, <code>taxonomic synonyms</code>, and <code>standardising spellings</code>
</li>
</ul>
<p>An example is as follows:</p>
<pre><code>taxonomic_updates:
- find: Carissa lanceolata
  replace: Carissa spinarum
  reason: Synonym reported by TaxonStand (2018-09-19)
- find: Melaleuca pallida
  replace: Callistemon pallidus
  reason: Synonym reported by TaxonStand (2018-09-19)</code></pre>
</div>
<div id="questions" class="section level4">
<h4 class="hasAnchor">
<a href="#questions" class="anchor"></a>Questions</h4>
<p>This section provides a place to record any queries we have about the dataset (recorded as a named array), including notes on any additonal traits that may have been collected in the study but have not been icnoproated into austraits.</p>
<p>An example is as follows:</p>
<pre><code>questions:
  questions for author: Triglochin procera has very different seed masses in the main traits spreadsheet and the field seeds worksheet. Which is correct? There are a number of species with values in the field leaves worksheet that are absent in the main traits worksheet - we have included this data into Austraits; please advise if this was inappropriate.
  austraits: need to map aquatic_terrestrial onto an actual trait once one is created.</code></pre>
</div>
</div>
</div>
</div>
<div id="adding" class="section level1">
<h1 class="hasAnchor">
<a href="#adding" class="anchor"></a>Adding data to Austraits</h1>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This sections explains how to format files to contribute a new study to AusTraits. It is important that all steps are followed so that our automated workflow proceeds without problems.</p>
<p>The main steps are:</p>
<ol style="list-style-type: decimal">
<li>Clone the <code>austraits.build</code> repository from github and create a new branch in the repo with the name of your dataset_id (for more info, see the document <a href="Working_with_github.Rmd">working with github</a>.</li>
<li>Create a new folder within the folder <code>data</code> with a name of the <code>dataset_id</code>, e.g. <code>Gallagher_2014</code>
</li>
<li>Prepare the files <code>data.csv</code> and <code>metadata.yml</code> and place them within the folder, as per instructions <a href="#create_data">below</a>.</li>
<li>Add the new study into the build framework and rebuild Austraits, as described under <a href="#adding">adding data to Austraits</a> below.</li>
<li>Run tests on the contributed data and correct the <code>data.csv</code> and <code>metadata.yml</code>files as necessary. See the section <a href="#running_tests">tests</a> for details.</li>
<li>Generate and proofread a report on the data. In particular, check that numeric trait values fall within a logical range relative to other studies and that individual trait observations are not unnecessarily excluded because their trait values are unsupported. See the section on generating <a href="#reports">reports</a> for details.</li>
<li>Return to step 3 if changes are made to the <code>data.csv</code> or <code>metadata.yml</code> files.</li>
<li>Push to GitHub.</li>
</ol>
<p>It may help to download one of the <a href="https://github.com/traitecoevo/austraits/tree/master/data">existing datasets</a> and use it as a template for your own files and a guide on required content. You should look at the files in the <a href="https://github.com/traitecoevo/austraits/tree/master/config">config folder</a>, in particular the <code>definitions</code> files for the list of traits we cover and the supported trait values for each trait. Or read through information on the [] supported traits and trait values](XXXX.)</p>
<p>Once you have prepared your <code>data.csv</code> and <code>metadata.yml</code> files within a folder in the <code>data</code> directory, you can incorporate the new data into Austraits by running:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw"><a href="../reference/austraits_rebuild_remake_setup.html">austraits_rebuild_remake_setup</a></span>()</a></code></pre></div>
<p>This step updates the file <code>remake.yml</code> with appropriate rules for the new dataset; similarly if you remove datasets, do the same. (At this stage, <a href="https://github.com/richfitz/remake">remake</a> offers no looping constructs so for now we generate the remake file using <a href="https://github.com/edwindj/whisker">whisker</a>.)</p>
<p>You can then rebuild Austraits, including your dataset.</p>
</div>
<div id="constructing-the-data-csv-file" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-the-data-csv-file" class="anchor"></a>Constructing the <code>data.csv</code> file</h2>
<!-- Lizzy - add details -->
</div>
<div id="constructing-the-metadata-yml-file" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-the-metadata-yml-file" class="anchor"></a>Constructing the <code>metadata.yml</code> file</h2>
<p>One way to construct the <code>metadata.yml</code> file is to use one of the existing files and modify yours to follow the same format. As a start, checkout some examples from <a href="https://github.com/traitecoevo/austraits/tree/master/data">existing studies in Austraits</a>, e.g. <a href="https://github.com/traitecoevo/austraits/blob/master/data/Angevin_2010/metadata.yml">Angevin_2010</a> or <a href="https://github.com/traitecoevo/austraits/blob/master/data/Wright_2004/metadata.yml">Wright_2004</a>.</p>
<p>Note, when editing the <code>metadata.yml</code>, edits should be made in a proper text editor (Microsoft word tends to stuff up the formatting). For example, Rstudio, textmate, sublime text, and Visual Studio Code are all good editors.</p>
<p>To assist you in constructing the <code>metadata.yml</code> file, we have developed functions to help fill in the different sections of the file. If you wish to include additional elements, you can afterwards edit the file further.</p>
<p>To use the functions, make sure you first run the following, to make the functions available</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(austraits.build)</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="co"># O3R</span></a>
<a class="sourceLine" id="cb26-3" title="3">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/load_all.html">load_all</a></span>()</a></code></pre></div>
<div id="creating-a-template" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-template" class="anchor"></a>Creating a template</h3>
<p>The first function creates a basic template for your the <code>metadata.yml</code> file for your study. Assuming you have already created a file <code>data.csv</code> in the folder <code>data/your_dataset_id</code>, run</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw"><a href="../reference/metadata_create_template.html">metadata_create_template</a></span>(dataset_id)</a></code></pre></div>
<p>The function will ask a series of questions and then create a relatively empty file <code>data/your_dataset_id/metadata.yml</code>. The key questions are:</p>
<ul>
<li>Is the data long vs wide? A wide dataset has each variable(i.e. trait ) as a column. A long dataset has each variable as a row and column as a species. <em>Select column for ‘species_name’ </em>Select column for ‘site_name’</li>
</ul>
</div>
<div id="adding-a-source" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-a-source" class="anchor"></a>Adding a source</h3>
<p>Three functions are available to help entering citation details for the source data.</p>
<p>The function <code>metadata_create_template</code> creates a template for the primary source with default fields for a journal article, which you can then edit manually.</p>
<p>Alternatively, if you have a <code>doi</code> for your study, use the function:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw"><a href="../reference/metadata_add_source_doi.html">metadata_add_source_doi</a></span>(dataset_id, doi)</a></code></pre></div>
<p>and the different elements within source will automatically be generated. By default, details are added as a primary source. To override this, specify the type</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw"><a href="../reference/metadata_add_source_doi.html">metadata_add_source_doi</a></span>(dataset_id, doi, <span class="dt">type=</span><span class="st">"secondary"</span>)</a></code></pre></div>
<p>Alternatively, if you have reference details saved in a bibtex file called <code>myref.bib</code> you can use the function</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw"><a href="../reference/metadata_add_source_doi.html">metadata_add_source_doi</a></span>(dataset_id, <span class="dt">file =</span> <span class="st">"myref.bib"</span>)</a></code></pre></div>
<p>(These options require the package <a href="https://github.com/ropensci/rcrossref">rcrossref</a> and <a href="https://github.com/ropensci/RefManageR/">RefManageR</a> to be installed.)</p>
</div>
<div id="adding-people" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-people" class="anchor"></a>Adding people</h3>
<p>The function <code>metadata_create_template</code> creates a template for entering details about people, which you can then edit manually.</p>
</div>
<div id="custom-r-code" class="section level3">
<h3 class="hasAnchor">
<a href="#custom-r-code" class="anchor"></a>Custom R code</h3>
<p>Occasionally all the changes we want to make to dataset may not fit into the prescribed workflow used in Austraits. For example, we assume each trait has a single unit. But there are a few datasets where data on different rows have different units. So we want to make to make some custom modifications to this particular dataset before the common pipeline of operations gets applied. To make this possible, the workflow allows for some custom R code to be run as a first step in the processing pipeline. That pipeline (in the function <a href="https://github.com/traitecoevo/austraits/blob/master/R/steps.R"><code>load_study</code></a>) looks like this:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">  data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="st">    </span><span class="kw">read_csv</span>(filename_data_raw, <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="st">    </span><span class="kw">custom_manipulation</span>(metadata[[<span class="st">"config"</span>]][[<span class="st">"custom_R_code"</span>]])() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="st">    </span><span class="kw">parse_data</span>(dataset_id, metadata) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-5" title="5"><span class="st">    </span>...</a></code></pre></div>
<p>Note the second line. After loading the csv file, we can apply some Custom R code small manipulations to the dataframe before processing it. Custom R code is valid R code, but written inside the <code>metadata.yml</code> file. While developing this, you’ll want to test your code. This can be achieved by running the function</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="kw"><a href="../reference/metadata_check_custom_R_code.html">metadata_check_custom_R_code</a></span>(dataset_id)</a></code></pre></div>
<p>which returns a data frame, showing how the datasets looks after being manipulated.mes</p>
</div>
<div id="defining-traits" class="section level3">
<h3 class="hasAnchor">
<a href="#defining-traits" class="anchor"></a>Defining traits</h3>
<p>Add traits</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw"><a href="../reference/metadata_add_traits.html">metadata_add_traits</a></span>(dataset_id)</a></code></pre></div>
<!-- TODO: You will be asked to indicate the columns you wish to keep as distinct traits -->
</div>
<div id="site-details" class="section level3">
<h3 class="hasAnchor">
<a href="#site-details" class="anchor"></a>Site details</h3>
<p>Add sites details</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw"><a href="../reference/metadata_add_sites.html">metadata_add_sites</a></span>(dataset_id, site_data)</a></code></pre></div>
<p>This function assumes you have site details stored in wide format, in R:</p>
<!-- TODO: need to indicate that the following code needs to be run with the assignment site_data for the previous code to work. -->
<pre><code>#&gt; Parsed with column specification:
#&gt; cols(
#&gt;   site_name = col_character(),
#&gt;   description = col_character(),
#&gt;   `elevation (m)` = col_double(),
#&gt;   `latitude (deg)` = col_double(),
#&gt;   `longitude (deg)` = col_double(),
#&gt;   `rainfall (mm)` = col_double()
#&gt; )
#&gt; # A tibble: 2 x 6
#&gt;   site_name description `elevation (m)` `latitude (deg)` `longitude (deg…
#&gt;   &lt;chr&gt;     &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
#&gt; 1 Atherton  Tropical r…             800            -17.1             146.
#&gt; 2 Cape Tri… Complex me…              25            -16.1             145.
#&gt; # … with 1 more variable: `rainfall (mm)` &lt;dbl&gt;</code></pre>
<p>If your data is in a file, you’ll need to read it in first.</p>
</div>
<div id="using-substitutions" class="section level3">
<h3 class="hasAnchor">
<a href="#using-substitutions" class="anchor"></a>Using substitutions</h3>
<p>Substitutions can be added by running:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw"><a href="../reference/metadata_add_substitution.html">metadata_add_substitution</a></span>(dataset_id, trait_name, find, replace)</a></code></pre></div>
<p>where <code>find</code> is the trait value used in the data.csv file and <code>replace</code> is the trait value supported by Austraits.</p>
</div>
<div id="update-taxonomy" class="section level3">
<h3 class="hasAnchor">
<a href="#update-taxonomy" class="anchor"></a>Update taxonomy</h3>
<p>We’ve implemented code to semi-automate the checking of names using the R package <a href="https://cran.r-project.org/web/packages/Taxonstand/index.html">Taxonstand</a> (for more documentation see <a href="https://www.rdocumentation.org/packages/Taxonstand/versions/2.1/topics/TPL">here</a>). To generate a suggested name change for a specific study run:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw"><a href="../reference/metadata_check_taxa.html">metadata_check_taxa</a></span>(<span class="st">"Westoby_2014"</span>)</a></code></pre></div>
<p>If TaxonStand finds taxonomic changes it will add the relevant lines of code directly to the metadata.yml file.</p>
<p>TaxonStand has been configured in the above function to only permit relatively certain changes (e.g. with a minor change to spelling or known synonym).</p>
<p>There are additional arguments you can add for the function <code>metadata_check_taxa</code> including: - <code>update</code> where the default is TRUE, meaning changes found will be added to the <code>metadata.yml</code> file - <code>typos</code> where the default is FALSE, meaning typos will not be corrected - <code>diffchar</code> which indicates the number of characters that can be different for a typo-match. Here the default is two.</p>
<p>Therefore, if you want the function <code>metadata_check_taxa</code> to correct 1 and 2 character typos, run the function as follows:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw"><a href="../reference/metadata_check_taxa.html">metadata_check_taxa</a></span>(<span class="st">"Westoby_2014"</span>, <span class="dt">typos=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>If TaxonStand fails to find a suitable alignment, and you have identified one yourself, you can add it to the metadata by running</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw"><a href="../reference/metadata_add_taxnomic_change.html">metadata_add_taxnomic_change</a></span>(study, find, replace, reason)</a></code></pre></div>
<p>For any plants that are only identified to genus, make sure the genus name is the first part of the name given; this will ensure its genus and family is recorded appropriately. I.e. use ‘Acacia sp. long leaf’, not ‘long leaf Acacia’.</p>
</div>
</div>
<div id="running_tests" class="section level2">
<h2 class="hasAnchor">
<a href="#running_tests" class="anchor"></a>Running tests</h2>
<p>You can also run some automated tests to ensure the dataset meets required set up. The tests run through a collection of pre-specified checks on the files for each study. The output alerts you to possible issues needing to be fixed, by comparing the data in the files with expected structure and allowed values, as specified in the definitions. NBy far the most common error is that there are unusual text characters, for example often special hyphen’s, quote symbols, plus-minus symbols. These should be replaced by simple text equivalents.</p>
<p>To run the tests, the variable <code>dataset_ids</code> must be defined in the global namespace, containing a vector of ids to check. For example</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="co"># load relevant functions</span></a>
<a class="sourceLine" id="cb40-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R/setup.R"</span>)</a>
<a class="sourceLine" id="cb40-3" title="3"></a>
<a class="sourceLine" id="cb40-4" title="4"><span class="co"># Tests run test on one study</span></a>
<a class="sourceLine" id="cb40-5" title="5">dataset_ids &lt;-<span class="st"> "Bragg_2002"</span></a>
<a class="sourceLine" id="cb40-6" title="6"><span class="kw"><a href="../reference/austraits_run_tests.html">austraits_run_tests</a></span>()</a>
<a class="sourceLine" id="cb40-7" title="7"></a>
<a class="sourceLine" id="cb40-8" title="8"><span class="co"># Tests run test on all studies</span></a>
<a class="sourceLine" id="cb40-9" title="9">dataset_ids &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"data"</span>)</a>
<a class="sourceLine" id="cb40-10" title="10"><span class="kw"><a href="../reference/austraits_run_tests.html">austraits_run_tests</a></span>()</a></code></pre></div>
</div>
<div id="reports" class="section level2">
<h2 class="hasAnchor">
<a href="#reports" class="anchor"></a>Reports / quality checks</h2>
<p>To enable better quality checks we have code to generate a report on the data in each study.</p>
<p>(Reports are written in <a href="https://rstudio.github.io/rmarkdown/">Rmarkdown</a> and generated via the <a href="https://cran.r-project.org/web/packages/knitr/">knitr</a> package. The template is stored in <code>scripts/report_study.html</code>).</p>
<p>To generate a report for a particular study:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">austraits &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">"export/data/austraits.rds"</span>)</a>
<a class="sourceLine" id="cb41-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R/report_utils.R"</span>)</a>
<a class="sourceLine" id="cb41-3" title="3"><span class="kw"><a href="../reference/build_study_report.html">build_study_report</a></span>(<span class="st">"Wright_2002"</span>)</a></code></pre></div>
<p>To generate a report for a collection of studies:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw"><a href="../reference/build_study_reports.html">build_study_reports</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Falster_2005_1"</span>, <span class="st">"Wright_2002"</span>))</a></code></pre></div>
<p>Or for all studies:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw"><a href="../reference/build_study_reports.html">build_study_reports</a></span>()</a></code></pre></div>
<p>Both functions <code>build_study_report</code> &amp; <code>build_study_reports</code> can accept an additional argument <code>overwrite=TRUE</code>, to overwrite existing reports if they exist. Eg.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="kw"><a href="../reference/build_study_report.html">build_study_report</a></span>(<span class="st">"Wright_2002"</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>One thing to check in particular, is any data have been excluded. These are available in the frame <code>excluded_data</code>.</p>
<p>Possible reasons for excluding that value include:</p>
<ul>
<li>
<em>Missing value</em>: Value was missing</li>
<li>
<em>Missing unit conversion</em>: Value was present but appropriate unit conversion was missing -&gt; you need to add it to the file <code>config/unit_conversions.csv</code>
</li>
<li>
<em>Unsupported trait</em>: <code>trait_name</code> not listed in <code>config/definitions.yml</code>, under <code>traits</code>
</li>
<li>
<em>Unsupported trait value</em>: For categorical traits, <code>value</code> for trait not included for that trait in <code>config/definitions.yml</code>
</li>
<li>
<em>Value does not convert to numeric</em>: Is there a strange character in the file preventing easy conversion?</li>
<li>
<em>Value out of allowable range</em>: Converted value falls outside of the allowable range specified for that trait in `config/definitions.ym</li>
</ul>
<p>For your dataset, you can investigate why you have excluded data as follows.</p>
<p>Look at everything</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">austraits<span class="op">$</span>excluded_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb45-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dataset_id<span class="op">==</span><span class="st">"ANBG_2019"</span>)</a>
<a class="sourceLine" id="cb45-3" title="3"><span class="co">#&gt; # A tibble: 2,043 x 11</span></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="co">#&gt;    error dataset_id species_name site_name observation_id trait_name value unit </span></a>
<a class="sourceLine" id="cb45-5" title="5"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb45-6" title="6"><span class="co">#&gt;  1 Unsu… ANBG_2019  Abelmoschus… site_at_… ANBG_2019_0001 LengthSam… 7     &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-7" title="7"><span class="co">#&gt;  2 Unsu… ANBG_2019  Abelmoschus… site_at_… ANBG_2019_0001 WidthSamp… 7     &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-8" title="8"><span class="co">#&gt;  3 Unsu… ANBG_2019  Abutilon ot… site_at_… ANBG_2019_0010 LengthSam… 20    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-9" title="9"><span class="co">#&gt;  4 Unsu… ANBG_2019  Abutilon ot… site_at_… ANBG_2019_0010 WidthSamp… 20    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-10" title="10"><span class="co">#&gt;  5 Unsu… ANBG_2019  Acacia acin… site_at_… ANBG_2019_0012 LengthSam… 21    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-11" title="11"><span class="co">#&gt;  6 Unsu… ANBG_2019  Acacia acin… site_at_… ANBG_2019_0012 WidthSamp… 22    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-12" title="12"><span class="co">#&gt;  7 Unsu… ANBG_2019  Acacia acum… site_at_… ANBG_2019_0017 LengthSam… 9     &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-13" title="13"><span class="co">#&gt;  8 Unsu… ANBG_2019  Acacia acum… site_at_… ANBG_2019_0017 WidthSamp… 9     &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-14" title="14"><span class="co">#&gt;  9 Unsu… ANBG_2019  Acacia adsu… site_at_… ANBG_2019_0019 LengthSam… 11    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-15" title="15"><span class="co">#&gt; 10 Unsu… ANBG_2019  Acacia adsu… site_at_… ANBG_2019_0019 WidthSamp… 11    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb45-16" title="16"><span class="co">#&gt; # … with 2,033 more rows, and 3 more variables: value_type &lt;fct&gt;,</span></a>
<a class="sourceLine" id="cb45-17" title="17"><span class="co">#&gt; #   replicates &lt;chr&gt;, original_name &lt;chr&gt;</span></a></code></pre></div>
<p>If you want to inspect this more closely, just pass it into <code>View</code></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">austraits<span class="op">$</span>excluded_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dataset_id<span class="op">==</span><span class="st">"ANBG_2019"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>()</a></code></pre></div>
<p>How many of each type:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">austraits<span class="op">$</span>excluded_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dataset_id<span class="op">==</span><span class="st">"ANBG_2019"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="st">  </span><span class="kw">pull</span>(error) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>()</a>
<a class="sourceLine" id="cb47-4" title="4"><span class="co">#&gt; .</span></a>
<a class="sourceLine" id="cb47-5" title="5"><span class="co">#&gt;                     Missing value                 Unsupported trait </span></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="co">#&gt;                                36                              1986 </span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="co">#&gt;           Unsupported trait value Value does not convert to numeric </span></a>
<a class="sourceLine" id="cb47-8" title="8"><span class="co">#&gt;                                12                                 9</span></a></code></pre></div>
<p>How many of each type by trait:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">austraits<span class="op">$</span>excluded_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dataset_id<span class="op">==</span><span class="st">"ANBG_2019"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-3" title="3"><span class="st">  </span><span class="kw">select</span>(trait_name, error) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>()</a>
<a class="sourceLine" id="cb48-5" title="5"><span class="co">#&gt;                        error</span></a>
<a class="sourceLine" id="cb48-6" title="6"><span class="co">#&gt; trait_name              Missing value Unsupported trait Unsupported trait value</span></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="co">#&gt;   germination_treatment             0                 0                       1</span></a>
<a class="sourceLine" id="cb48-8" title="8"><span class="co">#&gt;   LengthSample                      0               957                       0</span></a>
<a class="sourceLine" id="cb48-9" title="9"><span class="co">#&gt;   seed_mass                         0                 0                       0</span></a>
<a class="sourceLine" id="cb48-10" title="10"><span class="co">#&gt;   seed_shape                       36                 0                      11</span></a>
<a class="sourceLine" id="cb48-11" title="11"><span class="co">#&gt;   WidthSample                       0              1029                       0</span></a>
<a class="sourceLine" id="cb48-12" title="12"><span class="co">#&gt;                        error</span></a>
<a class="sourceLine" id="cb48-13" title="13"><span class="co">#&gt; trait_name              Value does not convert to numeric</span></a>
<a class="sourceLine" id="cb48-14" title="14"><span class="co">#&gt;   germination_treatment                                 0</span></a>
<a class="sourceLine" id="cb48-15" title="15"><span class="co">#&gt;   LengthSample                                          0</span></a>
<a class="sourceLine" id="cb48-16" title="16"><span class="co">#&gt;   seed_mass                                             9</span></a>
<a class="sourceLine" id="cb48-17" title="17"><span class="co">#&gt;   seed_shape                                            0</span></a>
<a class="sourceLine" id="cb48-18" title="18"><span class="co">#&gt;   WidthSample                                           0</span></a></code></pre></div>
<p>View records that aren’t missing values</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">austraits<span class="op">$</span>excluded_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dataset_id<span class="op">==</span><span class="st">"ANBG_2019"</span>, error <span class="op">!=</span><span class="st">"Missing value"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-3" title="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>()</a></code></pre></div>
</div>
<div id="pushing-to-github" class="section level2">
<h2 class="hasAnchor">
<a href="#pushing-to-github" class="anchor"></a>Pushing to GitHub</h2>
<p>By far our preferred way of contributing is for you to fork the database in github, add your dataset then send us a <a href="https://help.github.com/articles/using-pull-requests/">pull request</a>. If this is not possible, you could email the relevant files (see above) to the Austraits email: <a href="mailto:austraits.database@gmail.com" class="email">austraits.database@gmail.com</a></p>
</div>
</div>
<div id="appendices" class="section level1">
<h1 class="hasAnchor">
<a href="#appendices" class="anchor"></a>Appendices</h1>
<div id="file-types" class="section level2">
<h2 class="hasAnchor">
<a href="#file-types" class="anchor"></a>File types</h2>
<div id="csv" class="section level3">
<h3 class="hasAnchor">
<a href="#csv" class="anchor"></a>CSV</h3>
<p>A comma-separated values (CSV) file is a delimited text file that uses a comma to separate values. Each line of the file is a data record. Each record consists of one or more fields, separated by commas. This is a comma format for storing tables of data in a simple text file. You can edit it an Excel or in a text editor.For more, see <a href="https://en.wikipedia.org/wiki/Comma-separated_values">here</a>.</p>
</div>
<div id="yaml" class="section level3">
<h3 class="hasAnchor">
<a href="#yaml" class="anchor"></a>YAML files</h3>
<p>The <code>yml</code> file extension (pronounced “YAML”) <a href="https://en.wikipedia.org/wiki/YAML">is a type structured data file</a>, that is both human and machine readable. You can edit it any text editor, or also in Rstudio. Generally, yml is used in situations where a table does not suit because of variable lengths and or nested structures. It has the advantage over a spreadsheet in that the nested “headers” can have variable numbers of categories. The data under each of the hierarchical headings are easily extracted by R.</p>
</div>
</div>
<div id="custom_R_code" class="section level2">
<h2 class="hasAnchor">
<a href="#custom_R_code" class="anchor"></a>Adding custom R code into metadata.yml</h2>
<p>Occasionally all the changes we want to make to dataset may not fit into the prescribed workflow used in AusTraits. For example, we assume each trait has a single unit. But there are a few datasets where data on different rows have different units. So we want to make to make some custom modifications to this particular dataset before the common pipeline of operations gets applied. To make this possible, the workflow allows for some custom R code to be run as a first step in the processing pipeline. That pipeline (in the function <a href="https://github.com/traitecoevo/austraits/blob/master/R/steps.R#L59"><code>read_data_study</code></a>) looks like:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">  data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb50-2" title="2"><span class="st">    </span><span class="kw">read_csv</span>(filename_data_raw, <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="st">    </span><span class="kw">custom_manipulation</span>(metadata[[<span class="st">"config"</span>]][[<span class="st">"custom_R_code"</span>]])() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="st">    </span><span class="kw">parse_data</span>(dataset_id, metadata) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-5" title="5"><span class="st">    </span>...</a></code></pre></div>
<p>Note the second line.</p>
<div id="example-problem" class="section level3">
<h3 class="hasAnchor">
<a href="#example-problem" class="anchor"></a>Example problem</h3>
<p>As an example, for <code>Blackman_2010</code> we want to combine two columns to create an appropriate site variable. Here is the code that was included in <a href="https://github.com/traitecoevo/austraits/blob/master/data/Blackman_2010/metadata.yml">data/Blackman_2010/metadata.yml</a> under <code>custom_R_code</code>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb51-2" title="2">    <span class="dt">site =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(site <span class="op">==</span><span class="st"> "Mt Field"</span> <span class="op">&amp;</span><span class="st"> </span>habitat <span class="op">==</span><span class="st"> "Montane rainforest"</span>, <span class="st">"Mt Field_wet"</span>, site),</a>
<a class="sourceLine" id="cb51-3" title="3">    <span class="dt">site =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(site <span class="op">==</span><span class="st"> "Mt Field"</span> <span class="op">&amp;</span><span class="st"> </span>habitat <span class="op">==</span><span class="st"> "Dry sclerophyll"</span>, <span class="st">"Mt Field_dry"</span>, site)</a>
<a class="sourceLine" id="cb51-4" title="4">    )</a></code></pre></div>
<p>This is the finished solution, but to get there we did as follows.</p>
<p>Generally, this code should</p>
<ul>
<li>assume a single object called <code>data</code>, and apply whatever fixes are needed</li>
<li>use <a href="https://dplyr.tidyverse.org">dplyr</a> functions like <code>mutate</code>, <code>rename</code>, etc</li>
<li>use pipes to weave together a single statement, possible. (Otherwise you’ll need a semi colons <code>;</code> at the end of each statement).</li>
<li>be fully self contained (we’re not going to use any of the other remake machinery here)</li>
</ul>
<p>First, load an object called <code>data</code>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(readr)</a>
<a class="sourceLine" id="cb52-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(yaml)</a>
<a class="sourceLine" id="cb52-3" title="3"></a>
<a class="sourceLine" id="cb52-4" title="4">data &lt;-<span class="st"> </span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"data"</span>, <span class="st">"Blackman_2010"</span>, <span class="st">"data.csv"</span>), <span class="dt">col_types =</span> <span class="kw"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span>(<span class="dt">.default =</span> <span class="st">"c"</span>))</a>
<a class="sourceLine" id="cb52-5" title="5">data</a></code></pre></div>
<p>Second, write your code to manipulate data, like the example above/</p>
<p>Third, once you have some working code, you then want to add it into your yml file under a group <code>config</code> -&gt; <code>custom_R_code</code>.</p>
<p>Finally, check it works. Let’s assume you added it in. The function <code>metadata_check_custom_R_code</code> loads the data and applies the custom R code:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="kw"><a href="../reference/metadata_check_custom_R_code.html">metadata_check_custom_R_code</a></span>(<span class="st">"Blackman_2010"</span>)</a></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#file-structure">File structure</a></li>
      <li><a href="#configuration">Configuration</a></li>
      <li>
<a href="#a-tibble-21009-x-8">A tibble: 21,009 x 8</a><ul class="nav nav-pills nav-stacked">
<li><a href="#r">R</a></li>
      <li><a href="#data">Data</a></li>
      </ul>
</li>
      <li>
<a href="#adding">Adding data to Austraits</a><ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#constructing-the-data-csv-file">Constructing the <code>data.csv</code> file</a></li>
      <li><a href="#constructing-the-metadata-yml-file">Constructing the <code>metadata.yml</code> file</a></li>
      <li><a href="#running_tests">Running tests</a></li>
      <li><a href="#reports">Reports / quality checks</a></li>
      <li><a href="#pushing-to-github">Pushing to GitHub</a></li>
      </ul>
</li>
      <li>
<a href="#appendices">Appendices</a><ul class="nav nav-pills nav-stacked">
<li><a href="#file-types">File types</a></li>
      <li><a href="#custom_R_code">Adding custom R code into metadata.yml</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Rachael Gallagher, Elizabeth Wenk, Ian Wright, Sam Andrew, Caitlin Baxter, ARDC, ARC.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
